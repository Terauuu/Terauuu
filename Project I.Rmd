---
title: "Project I"
author: "Amy Ji(6009476), Tera Li(7545403), Brandon Su(5807961)"
output:
  html_document:
    fig_width: 5
    fig_height: 4
  pdf_document: 
      latex_engine: xelatex
date: "Apr 26, 2024"
---




```{r, message = F, warning = F, echo=F}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(skimr)
library(pander)
library(gridExtra)
```

### Introduction and Data Descrition 
Our project aims to predict student performance in mathematics using the "Student Performance" dataset from the UCI Machine Learning Repository. This dataset includes 395 students' grade and various other attributes from two schools in Portugal: Gabriel Pereira or Mousinho da Silveira. We have selected 14 attributes that we considered the most relevant for predicting the mathematics performance.  

Variables Description:\
Reason: Reason to choose this school\
Mjob: Mother's job\
Fjob: Father's job\
PStatus: Parent's cohabitation status ('T' - living together or 'A' - apart)\
Student's home address type ('U' - urban or 'R' - rural)\
Age: Student's age (15 - 22)\
Study_time: Weekly study time (1- <2 hours, 2- 2 to 5 hours, 3- 5 to 10 hours, 4- >10 hours)\
Family_rel: Quality of family relationships (1- very bad to 5- very good)\
Walc: Weekend alcohol consumption (1- very low to 5- very high)\
Health: Current health status (1- very bad to 5- very good)\
Absences: Number of school absences (integre)\
G1: First period grade (0 to 20)\
G2：Second period grade (0 to 20)\
G3：Final grade (0 to 20)


### Summary Statistics

The dataset consists of 395 rows and 14 columns. There are 5 character variables and 9 numeric variables. From these tables below, we can observe that all variables have no missing values indicating that the datset is complete. The distribution of numeric variables such as family relationships, health, and grades (G1-G3) demonstrates a left-skewed relationship, suggesting that students perform well in these areas.

```{r, echo = F}
mathdata <- read.csv("/Users/Tera/Desktop/PSTAT/126/mathdata.csv")
```
\

### Graphical Interpretation

\

#### Reasons to choose this school 

```{r, echo=F, out.width='400px', out.height='300px'}
ggplot(mathdata, aes(x=Reason)) + 
  geom_bar(fill="steelblue") +
  labs(title="Count of Students by Reason for Choosing School", x="Reason", y="Count") +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=45, hjust=1)) + 
  theme(plot.title = element_text(hjust = 0.5)) 
```

The histogram presents the count of students based on their reason for choosing a school. The reasons are categorized as courses, home, other, and reputation. The category with the highest count is "courses," indicating it is the most common reason among the students, followed by "reputation," with "home" being the least common reason.
\

#### Mother and Father's jobs 

```{r, echo=F, warning=F, out.width='400px', out.height='300px'}
mathdata$Mjob <- factor(mathdata$Mjob,
                        levels = c("teacher", "health", "services", "at_home", "other"),
                        labels = c("Teacher", "Health", "Services", "At Home", "Other"))

mathdata$Fjob <- factor(mathdata$Fjob,
                        levels = c("teacher", "health", "services", "at_home", "other"),
                        labels = c("Teacher", "Health", "Services", "At Home", "Other"))

par(mfrow=c(1,2))
# mother's job chart
mjob <- ggplot(mathdata, aes(x = Mjob)) + 
  geom_bar(fill = "lightblue") +
  geom_text(stat='count', aes(label=..count..), vjust=-0.5) +
  labs(title="Count of Mother's Jobs", x="Mother's Job", y="Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5)) 

# father's job chart
fjob <- ggplot(mathdata, aes(x = Fjob)) + 
  geom_bar(fill = "skyblue3") +
  geom_text(stat='count', aes(label=..count..), vjust=-0.5) + 
  labs(title="Count of Father's Jobs", x="Father's Job", y="Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(mjob, fjob, nrow = 1)
```

The first histogram now includes labels indicating the exact count of each category of mother's jobs. 'Other' has the highest count at 141, indicating a large diversity of jobs not specified in the other categories. The jobs 'Teacher', 'Services', and 'At Home' show counts of 58, 103, and 59 respectively, while 'Health' has the lowest count at 34.\
The second histogram shows the distribution of fathers' jobs. The 'Other' category has the highest count at 217, suggesting a wide variety of jobs not encompassed by the predefined groups. 'Teacher' and 'At Home' have the fewest counts at 29 and 20 respectively, with 'Services' in the middle at 111, and 'Health' just below it at 18.
\

#### Study Time

The boxplot below shows no significant relationship between study time and grades at each period.

```{r, echo = F, out.width='400px', out.height='300px'}
greade_grouped <- mathdata %>%
  pivot_longer(cols = starts_with("G"), names_to = "Grade", values_to = "Grade_Value")

ggplot(greade_grouped, aes(x = factor(Study_time), y = Grade_Value, fill = Grade)) +
  geom_boxplot(position = position_dodge(width = 0.75), width = 0.6, color = "black") +
  labs(x = "Study Time",
       y = "Grade",
       title = "Boxplot of Study Time and Grades") +
  scale_x_discrete(labels = c("<2 hours", "2 to 5 hours", "5 to 10 hours", ">10 hours")) +
  scale_fill_manual(values = c("G1" = "lightblue", "G2" = "skyblue3", "G3" = "steelblue")) +
  theme_minimal() + 
  theme(plot.title = element_text(hjust = 0.5)) +
  ylim(0, 20)
```

Not surprisingly, students who study more than 5 hours tend to have higher means than those who study less than 5 hours, but the mean difference is only around 1-3 points. One interesting feature observed from the triple-grouped side-by-side box plot is that regardless of the amount of time students spend on studying, there exist outliers who receive a grade of 0.
\

#### Family Relationship of Students

The box plot below visualizes the distribution of family relationship quality based on the parent's cohabitation status: 
```{r, echo = F, out.width='250px', out.height='150px'}
ggplot(mathdata, aes(x = Pstatus, y = Family_rel, fill = Pstatus)) +
  geom_boxplot() +
  labs(title = "Box Plot of Family Relationship Quality by Parent's Cohabitation Status",
       x = "Parent's Cohabitation Status",
       y = "Quality of Family Relationships") +
  theme_minimal() +
  scale_fill_brewer(palette = "Paired") +
  theme(plot.title = element_text(hjust = 0.5))
```

Examining the students whose parents do not live together ('A'), we observe that the box plot had a symmetric distribution around a median quality score of 4, which is indicative of generally good family relations with little variance. The lower end of the family relationship quality was observed at a score of 1. 

In contrast, the box plot for students whose parents live together ('T') exhibits a right skew, with most data concentrated around the higher scores, The lowest family relationship quality reported was at a score of 3, yet includes outliers at lower scores (1 and 2). This suggests that while most students in this group also experience good family relationships, there are exceptions where some report much poorer relationships.

\
\
\

#### Absences

```{r, echo=F, out.width='400px', out.height='300px'}
# separate absences into difference intervals
binned_data <- mathdata %>%
  mutate(Absence_Bin = cut(Absences, breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80))) %>%
  group_by(Absence_Bin) %>%
  summarize(Average_Score = mean(1/3 *(G1+G2+G3), na.rm = TRUE))

# barplot
ggplot(binned_data, aes(x = Absence_Bin, y = Average_Score, fill = Absence_Bin)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(x = "Number of Absences", y = "Average Grades", title = "Barplot of Average Score and Absences") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```

The absences is a quantitative variable, represents the number of absences for each student, ranging from 0 to 75. The barplot of average score for three periods and absences revealed an unexpected outcome, we assume that more absences lead to lower grades, a negative relationship between those two variables. However, the average score seems consistent for students with largely varying number of absences, which is a surprising outcome. 
\

#### Grades

```{r, echo=F, out.width='400px', out.height='300px'}
grades <- stack(mathdata[c("G1", "G2", "G3")])
names(grades) <- c("Scores", "Periods")
ggplot(grades, aes(x = Periods, y = Scores, fill = Periods)) +
  geom_boxplot() +
  labs(title = "Boxplot of Grades for Different Periods",
       x = "Periods", y = "Scores") +
  theme_minimal() +
  scale_fill_manual(values = c("lightblue", "skyblue3", "steelblue")) +
  theme(plot.title = element_text(hjust = 0.5))
```

G1, G2, G3 are quantitative variables, G1 and G2 represents the grades for each student in 2 different periods. G3 represents the final year grades. They all have the same range from 0 to 20, and the mean value is really close to each other. From the shapes of boxplots and summary statistics, we can see the grades distribution are relatively consistent, and we can make an assumption for now that these should have a similar distribution or spread. G3 has a wider range as there might be more outliers, which is the reason it has larger variation.

